% -*-cap2.tex-*-
% Este fichero es parte de la plantilla LaTeX para
% la realización de Proyectos Final de Carrera, protejido
% bajo los términos de la licencia GFDL.
% Para más información, la licencia completa viene incluida en el
% fichero fdl-1.3.tex

% Copyright (C) 2009 Pablo Recio Quijano 

En este capítulo vamos a describir y explicar los detalles de la implementación del sistema software y de la solución propuesta.

\section{Solución propuesta}

Debido a los objetivos y requisitos definidos en las anteriores secciones del documento, ya desde un primer momento se antojaba necesario realizar la implementación de una aplicación móvil, por lo que disponíamos de dos opciones a considerar: hacer una aplicación Android o IOS.\\

Bajo esta disyuntiva, los factores que nos llevaron a tomar la decisión de implementar una aplicación móvil Android fueron los siguientes:

\begin{itemize}
\item Como bien es sabido, la base de Android es Java. Java es uno de los lenguajes más universales y extendidos en el mundo del desarrollo, así que un grandísimo número de desarrolladores lo encontrarán más amigable. Esto, sumado a que desde 2008 me dedico profesionalmente al desarrollo de aplicaciones web con Java, fue un factor determinante a la hora tomar la decisión.
\item Android es un sistema más abierto y "libre" para el desarrollador, permitiéndole tener en una app un control mucho más amplio del terminal que en IOS.
\item La disponibilidad de las herramientas para desarrollar la aplicación también influyó en la decisión. Desarrollar una aplicación IOS requiere hacer uso de un ordenador Mac y de un iPhone para el testeo de la aplicación en el hardware real; herramientas que, teniendo en cuenta que necesitamos hacer uso de los sensores hardware del dispositivo, habría sido necesario adquirir para acometer el desarrollo.
\item Android copa actualmente el 92\% del mercado español \cite{website:cuota}, por lo que por estadística podría hacer uso de la aplicación un público más amplio.
\end{itemize}

Todos estos factores, sumados a la baja curva de aprendizaje necesaria debido principalmente a mi experiencia previa con Java, nos llevaron a seleccionar Android como plataforma de desarrollo.

\section{Entorno de construcción}

Una vez que se ha llegado a la conclusión anterior de implementar la aplicación móvil haciendo uso de Android, se procede a analizar el entorno de construcción que permitirá el desarrollo de todo el sistema.

\subsection{Android Studio}

Para el desarrollo de la aplicación haremos uso del entorno de desarrollo integrado (IDE) Android Studio \cite{website:androidstudio}. Android Studio es el entorno de desarrollo integrado oficial para el desarrollo de aplicaciones para Android y se basa en IntelliJ IDEA.\\

Entre las muchas ventajas que nos ofrece podemos contar con una vista ordenada y modular de los archivos que componen nuestro proyecto. La vista mostrada no se corresponde con la forma original de los archivos en disco, sino que está pensada para optimizar el trabajo.\\

Integrado en nuestro entorno de trabajo, podemos encontrar un sistema para el control de versiones, que incluye soporte para los repositorios más conocidos (Git, Subversion, etc). En nuestro caso se integró con Git, que es el software de control de versiones seleccionado para el presente proyecto, como ya se indicó anteriormente en el documento.\\

La interfaz gráfica está dividida de forma que se muestra una gran cantidad de información de forma eficiente. Además es totalmente personalizable, permitiendo al usuario mostrar y ocultar secciones según se requiera. Android Studio sigue el contexto de trabajo del usuario, mostrando las ventanas con las herramientas que considera oportunas en cada instante.\\

A continuación se muestra un ejemplo de interfaz gráfica:

\figura{androidstudio.png}{scale=0.34}{Interfaz de Android Studio}{androidstudio}{H}

\begin{enumerate}
\item Barra de herramientas: Permite realizar una amplia de gama de acciones: edición, búsqueda, iniciar aplicación, debug, etc. 
\item Barra de navegación: Permite navegar entre los archivos abiertos para facilitar su edición.
\item Ventana de edición: Permite modificar los diferentes archivos.
\item Ventana de herramientas: Proporciona acceso a la gestión del proyecto, control de versiones, consola, etc.
\item Barra de estado: Muestra el estado del proyecto, así como mensajes y avisos.
\end{enumerate}

Para finalizar nuestra visión de Android Studio, finalizaremos hablando de Gradle. Gradle es un sistema abierto que automatiza la compilación del código. Utiliza un grafo dirigido acíclico para determinar en qué orden se pueden ejecutar las tareas. Android Studio incorpora esta tecnología para facilitar la reutilización de código permitiendo generar APKs con distintas funcionalidades partiendo de un mismo proyecto.

\subsection{Android Software Development Kit}

Android SDK o Software Development Kit es un conjunto de herramientas para desarrollar, compilar y depurar aplicaciones para el sistema operativo Android, en definitiva, es una API que además de herramientas para el desarrollo, proporciona soporte técnico, ejemplos y una buena documentación.\\

El SDK incluye un emulador de dispositivos Android, lo que permite probar las aplicaciones de forma rápida y eficiente. Los parámetros de nuestro emulador pueden configurarse de forma que podemos elegir las características que tendrá nuestro dispositivo, como la memoria principal, el tamaño del dispositivo o la versión de Android, lo que permite al programador probar su código en una infinidad de dispositivos sin necesidad de adquirirlos.

\section{Código fuente}

El código fuente desarrollado de la aplicación está alojado en el repositorio GitHub:\\ 

\url{https://github.com/alvarogonzalezalvarez/SeniorFitness}\\

A continuación se muestra una lista con las diferentes clases Java implementadas durante la realización de la aplicación. Junto a cada una de las clases habrá una pequeña descripción sobre la labor que desempeña cada una.

\subsection{Activities}

Una Activity es un componente de la aplicación que contiene una pantalla con la que los usuarios pueden interactuar para realizar una acción. A cada actividad se le asigna una ventana en la que se pinta la interfaz de usuario asociada. A continuación se listan las activities que se han implementado:

\begin{itemize}
\item \textbf{AddUserActivity:} Activity que contiene la lógica de negocio referente a la pantalla de registro/alta de personas. 
\item \textbf{AgilidadActivity:} Activity que contiene la lógica de negocio referente a la pantalla del test Agilidad de la batería de pruebas Senior Fitness Test. Esta actividad extiende a ExerciseActivity.
\item \textbf{ExerciseActivity:} Activity que contiene toda la lógica de negocio común a todos los tests de la batería de pruebas Senior Fitness Test. Provee los métodos y funciones listas para su uso o sobreescritura por cada uno de los tests.
\item \textbf{FlexibilidadBrazosActivity:} Activity que contiene la lógica de negocio referente a la pantalla del test Flexibilidad de brazos de la batería de pruebas Senior Fitness Test. Esta actividad extiende a ExerciseActivity.
\item \textbf{FlexibilidadPiernasActivity:} Activity que contiene la lógica de negocio referente a la pantalla del test Flexibilidad de piernas de la batería de pruebas Senior Fitness Test. Esta actividad extiende a ExerciseActivity.
\item \textbf{FuerzaBrazosActivity:} Activity que contiene la lógica de negocio referente a la pantalla del test Fuerza de brazos de la batería de pruebas Senior Fitness Test. Esta actividad extiende a ExerciseActivity.
\item \textbf{FuerzaPiernasActivity:} Activity que contiene la lógica de negocio referente a la pantalla del test Fuerza de piernas de la batería de pruebas Senior Fitness Test. Esta actividad extiende a ExerciseActivity.
\item \textbf{InfoActivity:} Activity que contiene la lógica de negocio referente a la pantalla de información de los diferentes tests de la batería de pruebas Senior Fitness Test.
\item \textbf{MainActivity:} Activity que contiene la lógica de negocio referente a la pantalla principal de la aplicación. Esta actividad es la que se lanza por defecto cuando se abre la aplicación.
\item \textbf{ResistenciaAerobicaActivity:} Activity que contiene la lógica de negocio referente a la pantalla del test Resistencia aeróbica de la batería de pruebas Senior Fitness Test. Esta actividad extiende a ExerciseActivity.
\item \textbf{ResultsActivity:} Activity que contiene la lógica de negocio referente a la pantalla de resultados mostrada tras finalizar todos los tests de una sesión.
\item \textbf{SelectTestActivity:} Activity que contiene la lógica de negocio referente a la pantalla de selección de los diferentes tests que componen la batería de pruebas Senior Fitness Test.
\item \textbf{StartSessionActivity:} Activity que contiene la lógica de negocio referente a la pantalla de selección de la persona que comenzará la sesión de ejercicios.
\item \textbf{StatsActivity:} Activity que contiene la lógica de negocio referente a la pantalla de estadísticas de una sesión concreta ya completada por la persona para la cual se está visualizando el detalle.
\item \textbf{UserDetailsActivity:} Activity que contiene la lógica de negocio referente a la pantalla de detalle/historial de usuario.
\end{itemize}

\subsection{Listeners}

Los listeners o escuchadores son clases usadas para recibir notificaciones procedentes del SensorManager (clase que nos permite acceder a los sensores del dispositivo). A continuación listamos los listeners que se han implementado.

\begin{itemize}
\item \textbf{ExerciseListener:} Listener que implementa la clase SensorEventListener. Cada vez que hay un evento del sensor usado se invoca el método onSensorChanged, que será el método donde se harán los cálculos necesarios para detectar si el ejercicio se ha realizado de forma satisfactoria. Éste método debe ser implementado por los listeners que extienden de ExerciseListener.
\item \textbf{FuerzaBrazosListener:} Listener encargado de detectar y leer los movimientos realizados durante la realización del test Fuerza de brazos de la batería de pruebas Senior Fitness Test. Este listener extiende a ExerciseListener.
\item \textbf{FuerzaPiernasListener:} Listener encargado de detectar y leer los movimientos realizados durante la realización del test Fuerza de piernas de la batería de pruebas Senior Fitness Test. Este listener extiende a ExerciseListener.
\item \textbf{ResistenciaAerobicaListener:} Listener encargado de detectar y leer los movimientos realizados durante la realización del test Resistencia aeróbica de la batería de pruebas Senior Fitness Test. Este listener extiende a ExerciseListener.
\end{itemize}

\subsection{Base de Datos}

A continuación se listarán las clases encargadas de la definición, gestión y uso de la base de datos:

\begin{itemize}
\item \textbf{SeniorFitnessContract:} Clase java donde se definen las tablas usadas y los nombres y tipos de los campos de cada una de las mismas.
\item \textbf{SeniorFitnessDBHelper:} Clase java que extiende a SQLiteOpenHelper. Se encarga de gestionar la creación y manipulación de la base de datos, así como del versionado de la misma.
\end{itemize}

\subsection{Modelo}

Se listarán a continuación las clases Java que representan el modelo de la aplicación:

\begin{itemize}
\item \textbf{Result:} Clase java que representa los resultados obtenidos, asociado a un test, a una sesión y a una persona.
\item \textbf{Session:} Clase java que representa a las sesiones de tests que realizan las personas dadas de alta en la aplicación.
\item \textbf{Test:} Clase java que representa a los diferentes tests que componen la batería de pruebas Senior Fitness Test.
\item \textbf{User:} Clase java que representa a las personas dadas de alta en la aplicación.
\end{itemize}

\subsection{Adapters}

Un adapter es un objeto que funciona como puente entre un AdapterView y los correspondientes datos para esa vista, proporcionando acceso a los datos del elemento. También es el encargado de construir una vista (View) por cada elemento del conjunto de datos. A continuación listamos los adapters implementados para la aplicación:

\begin{itemize}
\item \textbf{SessionsAdapter:} Adapter utilizado para convertir en una View independiente cada elemento contenido en el listado de sesiones recuperadas para una persona concreta y mostradas en la pantalla de detalle de persona.
\item \textbf{TestsAdapter:} Adapter utilizado para convertir en una View independiente cada elemento contenido en el listado de tests mostrados en la pantalla de selección de test.
\item \textbf{UsersAdapter:} Adapter utilizado para convertir en una View independiente cada elemento contenido en el listado de personas dadas de alta en la aplicación, y que se muestran en la pantalla principal y en la pantalla de selección de persona.
\end{itemize}

\section{Detección de movimiento}



